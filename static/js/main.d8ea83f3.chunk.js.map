{"version":3,"sources":["getDrinkingWater.ts","DrinkingWaterMarker.tsx","Map.tsx","App.tsx","index.tsx"],"names":["options","a","roundedLat","Math","round","lat","roundedLng","lng","formData","around","fetch","then","res","json","elements","props","id","enableBackground","height","viewBox","width","fill","color","d","mapboxgl","require","workerClass","default","MapFountains","React","map","none","drinkingWaterNodes","drinkingWaterMarkers","updateDrinkingWater","throttle","getDrinkingWater","getCenter","this","addWaterMarkers","forEach","drinkingWaterNode","element","document","createElement","ReactDOM","DrinkingWaterMarker","marker","Marker","setLngLat","lon","addTo","push","initializeMap","accessToken","Map","container","style","center","parseFloat","localStorage","getItem","zoom","scrollZoom","addControl","GeolocateControl","positionOptions","enableHighAccuracy","on","some","componentDidMount","componentDidUpdate","requestAnimationFrame","resize","render","grow","App","className","StrictMode","getElementById"],"mappings":"8PAEA,yCAAe,WAAOA,GAAP,mBAAAC,EAAA,6DAMPC,EAAaC,KAAKC,MAAoB,EAAdJ,EAAQK,KAAW,EAC3CC,EAAaH,KAAKC,MAAoB,EAAdJ,EAAQO,KAAW,EAE3CC,EATO,0EAWgCR,EAAQS,OAXxC,YAWkDP,EAXlD,YAWgEI,EAXhE,8CAeNI,MAAM,gDAAD,OACsCF,EADtC,4BAGTG,MAAK,SAACC,GAAD,OAAqDA,EAAIC,UAC9DF,MAAK,SAAAC,GAAG,OAAIA,EAAIE,aAnBN,2CAAf,sD,OCAe,WAACC,GAAD,OACb,qBACEC,GAAG,UACHC,iBAAiB,kBACjBC,OAAO,OACPC,QAAQ,cACRC,MAAM,OACNC,KAAMN,EAAMO,OAAS,OANvB,SAQE,8BACE,sBAAMC,EAAE,2SACR,sBAAMA,EAAE,iJACR,sBAAMA,EAAE,gGACR,sBAAMA,EAAE,yIACR,sBAAMA,EAAE,oL,YCJd,MAAMC,EAAWC,EAAQ,IAEzBD,EAASE,YACPD,EAAQ,IAAqDE,QAE/D,MAAMC,UAAqBC,gBAAyB,eAAD,oBACjDC,IAAmBC,OAD8B,KAGjDC,mBAEI,GAL6C,KAOjDC,qBAA0C,GAPO,KASjDC,oBAAsBC,KAAS,KAC7BL,eAAeA,IACbM,EAAiB,CACf3B,OAAQ,IACRJ,IAAKyB,EAAIO,YAAYhC,IACrBE,IAAKuB,EAAIO,YAAY9B,MACpBI,KAAK2B,KAAKC,mBALfT,CAMGQ,KAAKR,OACP,KAjB8C,KAoDjDS,gBAAmBP,IACjBF,eAAeA,IACbE,EAAmBQ,SAAQC,IACzB,IAAKH,KAAKN,mBAAmBS,EAAkBzB,IAAK,CAClD,MAAM0B,EAAUC,SAASC,cAAc,OACvCC,SAAgB,cAACC,EAAD,IAAyBJ,GAEzC,MAAMK,EAA0B,IAAIvB,EAASwB,OAAO,CAClDN,YACCO,UAAU,CAACR,EAAkBS,IAAKT,EAAkBpC,MAEvD0C,EAAOI,MAAMrB,GAEbQ,KAAKN,mBAAmBS,EAAkBzB,IAAMyB,EAEhDH,KAAKL,qBAAqBmB,KAAKL,SAdrCjB,CAiBGQ,KAAKR,MAnDVuB,gBACG7B,EAAiB8B,YAChB,uGAEF,MAAMxB,EAAW,IAAIN,EAAS+B,IAAI,CAChCC,UAAW,MACXC,MACE,0EACFC,OAAQ,CACNrD,IAAKsD,WAAWC,aAAaC,QAAQ,cAAgB,SACrDtD,IAAKoD,WAAWC,aAAaC,QAAQ,cAAgB,SAEvDC,KAAM,GACNC,YAAY,IAGdjC,EAAIkC,WACF,IAAIxC,EAASyC,iBAAiB,CAC5BC,gBAAiB,CACfC,oBAAoB,MAK1BrC,EAAIsC,GAAG,QAAQ,KACb9B,KAAKR,IAAMuC,eAAKvC,GAEhBQ,KAAKJ,yBAGPJ,EAAIsC,GAAG,OAAQ9B,KAAKJ,qBAwBtBoC,oBACEhC,KAAKe,gBAGPkB,qBACEC,uBAAsB,KACpB1C,eAAeA,GAAOA,EAAI2C,UAA1B3C,CAAoCQ,KAAKR,QAI7C4C,SACE,OAAO,cAAC,IAAD,CAAMC,MAAI,EAAC3D,GAAG,SAIVY,QC7FAgD,MARf,WACE,OACE,cAAC,IAAD,CAAMC,UAAU,MAAMpB,MAAO,CAAEvC,OAAQ,QAASE,MAAO,SAAvD,SACE,cAACmC,EAAD,O,MCDNV,IAAS6B,OACP,cAAC,IAAMI,WAAP,UACE,cAAC,EAAD,MAEFnC,SAASoC,eAAe,W","file":"static/js/main.d8ea83f3.chunk.js","sourcesContent":["export type DrinkingWaterNode = { id: number; lat: number; lon: number };\n\nexport default async (options: {\n  around: number;\n  lat: number;\n  lng: number;\n}): Promise<DrinkingWaterNode[]> => {\n  // round to closest even decimal (ex: 45.53 -> 45.6; 45.49 -> 45.4)\n  const roundedLat = Math.round(options.lat * 5) / 5;\n  const roundedLng = Math.round(options.lng * 5) / 5;\n\n  const formData = `\n    [out:json];\n    (node[\"amenity\"=\"drinking_water\"](around:${options.around},${roundedLat},${roundedLng}););\n    out;>;out;\n  `;\n\n  return fetch(\n    `https://overpass-api.de/api/interpreter?data=${formData}&output&cache-only=true`\n  )\n    .then((res): Promise<{ elements: DrinkingWaterNode[] }> => res.json())\n    .then(res => res.elements);\n};\n","import * as React from \"react\";\n\nexport default (props: { color?: string }) => (\n  <svg\n    id=\"Layer_1\"\n    enableBackground=\"new 0 0 512 512\"\n    height=\"20px\"\n    viewBox=\"0 0 512 512\"\n    width=\"20px\"\n    fill={props.color || \"blue\"}\n  >\n    <g>\n      <path d=\"m421.082 355.479c-16.269-24.198-32.288-43.872-32.962-44.698-2.849-3.49-7.115-5.514-11.62-5.514s-8.771 2.024-11.62 5.514c-.674.826-16.693 20.5-32.962 44.698-34.685 51.594-34.685 70.908-34.685 77.255 0 43.708 35.559 79.267 79.267 79.267s79.267-35.559 79.267-79.267c0-6.347 0-25.662-34.685-77.255z\" />\n      <path d=\"m71.233 64.267h224.934c8.284 0 15-6.716 15-15v-34.267c0-8.284-6.716-15-15-15h-224.934c-8.284 0-15 6.716-15 15v34.267c0 8.284 6.716 15 15 15z\" />\n      <path d=\"m56.233 159.6v64.267c0 8.284 6.716 15 15 15h19.267v-94.267h-19.267c-8.284 0-15 6.716-15 15z\" />\n      <path d=\"m329.366 256c0 8.284 6.716 15 15 15h64.268c8.284 0 15-6.716 15-15v-32.133c0-43.708-35.56-79.267-79.268-79.267h-67.466v94.267h52.466z\" />\n      <path d=\"m231.9 128.533h-1.067v-34.266h-94.267v34.267h-1.066c-8.284 0-15 6.716-15 15v96.4c0 8.284 6.716 15 15 15h96.4c8.284 0 15-6.716 15-15v-96.4c0-8.285-6.715-15.001-15-15.001z\" />\n    </g>\n  </svg>\n);\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport throttle from \"lodash/throttle\";\nimport { Map } from \"mapbox-gl\";\nimport View from \"react-flexview\";\nimport { Option, none, some, map } from \"fp-ts/lib/Option\";\nimport getDrinkingWater, { DrinkingWaterNode } from \"./getDrinkingWater\";\nimport DrinkingWaterMarker from \"./DrinkingWaterMarker\";\n\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"./map.scss\";\n\nconst mapboxgl = require(\"mapbox-gl/dist/mapbox-gl-csp\");\n\nmapboxgl.workerClass =\n  require(\"worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker\").default;\n\nclass MapFountains extends React.PureComponent<{}> {\n  map: Option<Map> = none;\n\n  drinkingWaterNodes: {\n    [id: string]: DrinkingWaterNode;\n  } = {};\n\n  drinkingWaterMarkers: mapboxgl.Marker[] = [];\n\n  updateDrinkingWater = throttle(() => {\n    map<Map, void>(map => {\n      getDrinkingWater({\n        around: 20000,\n        lat: map.getCenter().lat,\n        lng: map.getCenter().lng\n      }).then(this.addWaterMarkers);\n    })(this.map);\n  }, 1000);\n\n  initializeMap() {\n    (mapboxgl as any).accessToken =\n      \"pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw\";\n\n    const map: Map = new mapboxgl.Map({\n      container: \"map\",\n      style:\n        \"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true\",\n      center: {\n        lat: parseFloat(localStorage.getItem(\"start_lat\") || \"45.46\"),\n        lng: parseFloat(localStorage.getItem(\"start_lng\") || \"9.19\")\n      },\n      zoom: 15.0,\n      scrollZoom: false\n    });\n\n    map.addControl(\n      new mapboxgl.GeolocateControl({\n        positionOptions: {\n          enableHighAccuracy: true\n        }\n      })\n    );\n\n    map.on(\"load\", () => {\n      this.map = some(map);\n\n      this.updateDrinkingWater();\n    });\n\n    map.on(\"move\", this.updateDrinkingWater);\n  }\n\n  addWaterMarkers = (drinkingWaterNodes: DrinkingWaterNode[]) => {\n    map<Map, void>(map => {\n      drinkingWaterNodes.forEach(drinkingWaterNode => {\n        if (!this.drinkingWaterNodes[drinkingWaterNode.id]) {\n          const element = document.createElement(\"div\");\n          ReactDOM.render(<DrinkingWaterMarker />, element);\n\n          const marker: mapboxgl.Marker = new mapboxgl.Marker({\n            element\n          }).setLngLat([drinkingWaterNode.lon, drinkingWaterNode.lat]);\n\n          marker.addTo(map);\n\n          this.drinkingWaterNodes[drinkingWaterNode.id] = drinkingWaterNode;\n\n          this.drinkingWaterMarkers.push(marker);\n        }\n      });\n    })(this.map);\n  };\n\n  componentDidMount() {\n    this.initializeMap();\n  }\n\n  componentDidUpdate() {\n    requestAnimationFrame(() => {\n      map<Map, void>(map => map.resize())(this.map);\n    });\n  }\n\n  render() {\n    return <View grow id=\"map\" />;\n  }\n}\n\nexport default MapFountains;\n","import React from \"react\";\nimport Map from \"./Map\";\nimport View from \"react-flexview\";\n\nfunction App() {\n  return (\n    <View className=\"App\" style={{ height: \"100vh\", width: \"100vw\" }}>\n      <Map />\n    </View>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nimport \"./index.scss\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}