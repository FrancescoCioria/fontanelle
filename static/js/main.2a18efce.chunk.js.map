{"version":3,"sources":["DrinkingWaterMarker.tsx","Map.tsx","getDrinkingWater.ts","App.tsx","index.tsx"],"names":["props","id","enableBackground","height","viewBox","width","fill","color","d","mapboxgl","require","workerClass","default","MapFountains","React","map","none","drinkingWaterNodes","drinkingWaterMarkers","updateDrinkingWater","debounce","options","formData","around","lat","lng","fetch","then","res","json","elements","getDrinkingWater","getCenter","this","addWaterMarkers","forEach","drinkingWaterNode","element","document","createElement","ReactDOM","DrinkingWaterMarker","marker","Marker","setLngLat","lon","addTo","push","initializeMap","accessToken","navigator","geolocation","getCurrentPosition","e","Map","container","style","center","coords","latitude","longitude","zoom","scrollZoom","addControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","on","some","querySelector","click","componentDidMount","componentDidUpdate","requestAnimationFrame","resize","render","grow","App","className","StrictMode","getElementById"],"mappings":"6OAEe,WAACA,GAAD,OACb,qBACEC,GAAG,UACHC,iBAAiB,kBACjBC,OAAO,OACPC,QAAQ,cACRC,MAAM,OACNC,KAAMN,EAAMO,OAAS,OANvB,SAQE,8BACE,sBAAMC,EAAE,2SACR,sBAAMA,EAAE,iJACR,sBAAMA,EAAE,gGACR,sBAAMA,EAAE,yIACR,sBAAMA,EAAE,oL,YCJd,MAAMC,EAAWC,EAAQ,IAEzBD,EAASE,YACPD,EAAQ,IAAqDE,QAE/D,MAAMC,UAAqBC,gBAAyB,eAAD,oBACjDC,IAAmBC,OAD8B,KAGjDC,mBAEI,GAL6C,KAOjDC,qBAA0C,GAPO,KASjDC,oBAAsBC,KAAS,KAC7BL,eAAeA,ICzBJ,OAAOM,IASpB,MAAMC,EAAQ,0EAE+BD,EAAQE,OAFvC,YAEiDF,EAAQG,IAFzD,YAEgEH,EAAQI,IAFxE,4BAMd,OAAOC,MAAM,gDAAD,OACsCJ,EADtC,4BAGTK,MAAMC,GAAoDA,EAAIC,SAC9DF,MAAKC,GAAOA,EAAIE,YDOfC,CAAiB,CACfR,OAAQ,IACRC,IAAKT,EAAIiB,YAAYR,IACrBC,IAAKV,EAAIiB,YAAYP,MACpBE,KAAKM,KAAKC,mBALfnB,CAMGkB,KAAKlB,OACP,KAjB8C,KA6DjDmB,gBAAmBjB,IACjBF,eAAeA,IACbE,EAAmBkB,SAAQC,IACzB,IAAKH,KAAKhB,mBAAmBmB,EAAkBnC,IAAK,CAClD,MAAMoC,EAAUC,SAASC,cAAc,OACvCC,SAAgB,cAACC,EAAD,IAAyBJ,GAEzC,MAAMK,EAA0B,IAAIjC,EAASkC,OAAO,CAClDN,YACCO,UAAU,CAACR,EAAkBS,IAAKT,EAAkBZ,MAEvDkB,EAAOI,MAAM/B,GAEbkB,KAAKhB,mBAAmBmB,EAAkBnC,IAAMmC,EAEhDH,KAAKf,qBAAqB6B,KAAKL,SAdrC3B,CAiBGkB,KAAKlB,MA5DViC,gBACGvC,EAAiBwC,YAChB,uGAEEC,UAAUC,aACZD,UAAUC,YAAYC,oBAAmBC,IACvC,MAAMtC,EAAW,IAAIN,EAAS6C,IAAI,CAChCC,UAAW,MACXC,MACE,0EACFC,OAAQ,CACNjC,IAAK6B,EAAEK,OAAOC,SACdlC,IAAK4B,EAAEK,OAAOE,WAEhBC,KAAM,GACNC,YAAY,IAGd/C,EAAIgD,WACF,IAAItD,EAASuD,iBAAiB,CAC5BC,gBAAiB,CACfC,oBAAoB,GAEtBC,mBAAmB,KAIvBpD,EAAIqD,GAAG,QAAQ,KAAO,IAAD,EACnBnC,KAAKlB,IAAMsD,eAAKtD,GAEhBkB,KAAKd,sBAEL,QAAC,EACCmB,SAASgC,cAAc,mCADzB,SAEGC,WAGLxD,EAAIqD,GAAG,OAAQnC,KAAKd,wBA0B1BqD,oBACEvC,KAAKe,gBAGPyB,qBACEC,uBAAsB,KACpB3D,eAAeA,GAAOA,EAAI4D,UAA1B5D,CAAoCkB,KAAKlB,QAI7C6D,SACE,OAAO,cAAC,IAAD,CAAMC,MAAI,EAAC5E,GAAG,SAIVY,QEtGAiE,MARf,WACE,OACE,cAAC,IAAD,CAAMC,UAAU,MAAMvB,MAAO,CAAErD,OAAQ,QAASE,MAAO,SAAvD,SACE,cAACiD,EAAD,O,MCDNd,IAASoC,OACP,cAAC,IAAMI,WAAP,UACE,cAAC,EAAD,MAEF1C,SAAS2C,eAAe,W","file":"static/js/main.2a18efce.chunk.js","sourcesContent":["import * as React from \"react\";\n\nexport default (props: { color?: string }) => (\n  <svg\n    id=\"Layer_1\"\n    enableBackground=\"new 0 0 512 512\"\n    height=\"20px\"\n    viewBox=\"0 0 512 512\"\n    width=\"20px\"\n    fill={props.color || \"blue\"}\n  >\n    <g>\n      <path d=\"m421.082 355.479c-16.269-24.198-32.288-43.872-32.962-44.698-2.849-3.49-7.115-5.514-11.62-5.514s-8.771 2.024-11.62 5.514c-.674.826-16.693 20.5-32.962 44.698-34.685 51.594-34.685 70.908-34.685 77.255 0 43.708 35.559 79.267 79.267 79.267s79.267-35.559 79.267-79.267c0-6.347 0-25.662-34.685-77.255z\" />\n      <path d=\"m71.233 64.267h224.934c8.284 0 15-6.716 15-15v-34.267c0-8.284-6.716-15-15-15h-224.934c-8.284 0-15 6.716-15 15v34.267c0 8.284 6.716 15 15 15z\" />\n      <path d=\"m56.233 159.6v64.267c0 8.284 6.716 15 15 15h19.267v-94.267h-19.267c-8.284 0-15 6.716-15 15z\" />\n      <path d=\"m329.366 256c0 8.284 6.716 15 15 15h64.268c8.284 0 15-6.716 15-15v-32.133c0-43.708-35.56-79.267-79.268-79.267h-67.466v94.267h52.466z\" />\n      <path d=\"m231.9 128.533h-1.067v-34.266h-94.267v34.267h-1.066c-8.284 0-15 6.716-15 15v96.4c0 8.284 6.716 15 15 15h96.4c8.284 0 15-6.716 15-15v-96.4c0-8.285-6.715-15.001-15-15.001z\" />\n    </g>\n  </svg>\n);\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport debounce from \"lodash/debounce\";\nimport { Map } from \"mapbox-gl\";\nimport View from \"react-flexview\";\nimport { Option, none, some, map } from \"fp-ts/lib/Option\";\nimport getDrinkingWater, { DrinkingWaterNode } from \"./getDrinkingWater\";\nimport DrinkingWaterMarker from \"./DrinkingWaterMarker\";\n\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"./map.scss\";\n\nconst mapboxgl = require(\"mapbox-gl/dist/mapbox-gl-csp\");\n\nmapboxgl.workerClass =\n  require(\"worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker\").default;\n\nclass MapFountains extends React.PureComponent<{}> {\n  map: Option<Map> = none;\n\n  drinkingWaterNodes: {\n    [id: string]: DrinkingWaterNode;\n  } = {};\n\n  drinkingWaterMarkers: mapboxgl.Marker[] = [];\n\n  updateDrinkingWater = debounce(() => {\n    map<Map, void>(map => {\n      getDrinkingWater({\n        around: 2000,\n        lat: map.getCenter().lat,\n        lng: map.getCenter().lng\n      }).then(this.addWaterMarkers);\n    })(this.map);\n  }, 200);\n\n  initializeMap() {\n    (mapboxgl as any).accessToken =\n      \"pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw\";\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(e => {\n        const map: Map = new mapboxgl.Map({\n          container: \"map\",\n          style:\n            \"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true\",\n          center: {\n            lat: e.coords.latitude,\n            lng: e.coords.longitude\n          },\n          zoom: 15.0,\n          scrollZoom: false\n        });\n\n        map.addControl(\n          new mapboxgl.GeolocateControl({\n            positionOptions: {\n              enableHighAccuracy: true\n            },\n            trackUserLocation: true\n          })\n        );\n\n        map.on(\"load\", () => {\n          this.map = some(map);\n\n          this.updateDrinkingWater();\n\n          (\n            document.querySelector(\".mapboxgl-ctrl-geolocate\") as HTMLElement\n          )?.click();\n        });\n\n        map.on(\"move\", this.updateDrinkingWater);\n      });\n    }\n  }\n\n  addWaterMarkers = (drinkingWaterNodes: DrinkingWaterNode[]) => {\n    map<Map, void>(map => {\n      drinkingWaterNodes.forEach(drinkingWaterNode => {\n        if (!this.drinkingWaterNodes[drinkingWaterNode.id]) {\n          const element = document.createElement(\"div\");\n          ReactDOM.render(<DrinkingWaterMarker />, element);\n\n          const marker: mapboxgl.Marker = new mapboxgl.Marker({\n            element\n          }).setLngLat([drinkingWaterNode.lon, drinkingWaterNode.lat]);\n\n          marker.addTo(map);\n\n          this.drinkingWaterNodes[drinkingWaterNode.id] = drinkingWaterNode;\n\n          this.drinkingWaterMarkers.push(marker);\n        }\n      });\n    })(this.map);\n  };\n\n  componentDidMount() {\n    this.initializeMap();\n  }\n\n  componentDidUpdate() {\n    requestAnimationFrame(() => {\n      map<Map, void>(map => map.resize())(this.map);\n    });\n  }\n\n  render() {\n    return <View grow id=\"map\" />;\n  }\n}\n\nexport default MapFountains;\n","export type DrinkingWaterNode = { id: number; lat: number; lon: number };\n\nexport default async (options: {\n  around: number;\n  lat: number;\n  lng: number;\n}): Promise<DrinkingWaterNode[]> => {\n  // round to closest even decimal (ex: 45.53 -> 45.6; 45.49 -> 45.4)\n  // const roundedLat = Math.round(options.lat * 5) / 5;\n  // const roundedLng = Math.round(options.lng * 5) / 5;\n\n  const formData = `\n    [out:json];\n    (node[\"amenity\"=\"drinking_water\"](around:${options.around},${options.lat},${options.lng}););\n    out;>;out;\n  `;\n\n  return fetch(\n    `https://overpass-api.de/api/interpreter?data=${formData}&output&cache-only=true`\n  )\n    .then((res): Promise<{ elements: DrinkingWaterNode[] }> => res.json())\n    .then(res => res.elements);\n};\n","import React from \"react\";\nimport Map from \"./Map\";\nimport View from \"react-flexview\";\n\nfunction App() {\n  return (\n    <View className=\"App\" style={{ height: \"100vh\", width: \"100vw\" }}>\n      <Map />\n    </View>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nimport \"./index.scss\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}