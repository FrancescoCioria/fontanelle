(this.webpackJsonpfontanelle=this.webpackJsonpfontanelle||[]).push([[0],{34:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),r=n(5),i=n.n(r),c=n(12),s=n.n(c),l=n(3),d=n.n(l),h=n(2),u=n(0),p=function(e){return Object(u.jsx)("svg",{id:"Layer_1",enableBackground:"new 0 0 512 512",height:"20px",viewBox:"0 0 512 512",width:"20px",fill:e.color||"blue",children:Object(u.jsxs)("g",{children:[Object(u.jsx)("path",{d:"m421.082 355.479c-16.269-24.198-32.288-43.872-32.962-44.698-2.849-3.49-7.115-5.514-11.62-5.514s-8.771 2.024-11.62 5.514c-.674.826-16.693 20.5-32.962 44.698-34.685 51.594-34.685 70.908-34.685 77.255 0 43.708 35.559 79.267 79.267 79.267s79.267-35.559 79.267-79.267c0-6.347 0-25.662-34.685-77.255z"}),Object(u.jsx)("path",{d:"m71.233 64.267h224.934c8.284 0 15-6.716 15-15v-34.267c0-8.284-6.716-15-15-15h-224.934c-8.284 0-15 6.716-15 15v34.267c0 8.284 6.716 15 15 15z"}),Object(u.jsx)("path",{d:"m56.233 159.6v64.267c0 8.284 6.716 15 15 15h19.267v-94.267h-19.267c-8.284 0-15 6.716-15 15z"}),Object(u.jsx)("path",{d:"m329.366 256c0 8.284 6.716 15 15 15h64.268c8.284 0 15-6.716 15-15v-32.133c0-43.708-35.56-79.267-79.268-79.267h-67.466v94.267h52.466z"}),Object(u.jsx)("path",{d:"m231.9 128.533h-1.067v-34.266h-94.267v34.267h-1.066c-8.284 0-15 6.716-15 15v96.4c0 8.284 6.716 15 15 15h96.4c8.284 0 15-6.716 15-15v-96.4c0-8.285-6.715-15.001-15-15.001z"})]})})};n(33),n(34);const g=n(35);g.workerClass=n(36).default;class m extends o.PureComponent{constructor(...e){super(...e),this.map=h.none,this.drinkingWaterNodes={},this.drinkingWaterMarkers=[],this.updateDrinkingWater=s()((()=>{Object(h.map)((e=>{(async e=>{const t=Math.round(100*e.lat)/100,n=Math.round(100*e.lng)/100,o='\n    [out:json];\n    (node["amenity"="drinking_water"](around:'.concat(e.around,",").concat(t,",").concat(n,"););\n    out;>;out;\n  ");return fetch("https://overpass-api.de/api/interpreter?data=".concat(o,"&output&cache-only=true")).then((e=>e.json())).then((e=>e.elements))})({around:2e3,lat:e.getCenter().lat,lng:e.getCenter().lng}).then(this.addWaterMarkers)}))(this.map)}),200),this.addWaterMarkers=e=>{Object(h.map)((t=>{e.forEach((e=>{if(!this.drinkingWaterNodes[e.id]){const n=document.createElement("div");r.render(Object(u.jsx)(p,{}),n);const o=new g.Marker({element:n}).setLngLat([e.lon,e.lat]);o.addTo(t),this.drinkingWaterNodes[e.id]=e,this.drinkingWaterMarkers.push(o)}}))}))(this.map)}}initializeMap(){g.accessToken="pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw",navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const t=new g.Map({container:"map",style:"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true",center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:15,scrollZoom:!1});t.addControl(new g.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),t.on("load",(()=>{var e;this.map=Object(h.some)(t),this.updateDrinkingWater(),null===(e=document.querySelector(".mapboxgl-ctrl-geolocate"))||void 0===e||e.click()})),t.on("move",this.updateDrinkingWater)}))}componentDidMount(){this.initializeMap()}componentDidUpdate(){requestAnimationFrame((()=>{Object(h.map)((e=>e.resize()))(this.map)}))}render(){return Object(u.jsx)(d.a,{grow:!0,id:"map"})}}var j=m;const v=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function b(e){if("serviceWorker"in navigator){if(new URL("/fontanelle",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const t="".concat("/fontanelle","/service-worker.js");v?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((n=>{const o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):w(e,t)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):w(t,e)}))}}function w(e,t){navigator.serviceWorker.register(e,{scope:"/fontanelle/"}).then((e=>{console.log(e.scope),e.onupdatefound=()=>{const n=e.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((e=>{console.error("Error during service worker registration:",e)}))}var f=()=>{const[e,t]=a.a.useState(!1),[n,r]=a.a.useState(h.none),i=e=>{t(!0),r(Object(h.fromNullable)(e.waiting))};Object(o.useEffect)((()=>{b({onUpdate:i})}),[]);return e?Object(u.jsxs)(d.a,{className:"updateAvailable",vAlignContent:"center",hAlignContent:"center",style:{background:"lightgreen",height:25,color:"black"},children:["Update Available",Object(u.jsx)("span",{style:{marginLeft:60,textDecoration:"underline",cursor:"pointer"},onClick:()=>(console.log("reload page"),Object(h.map)((e=>e.postMessage({type:"SKIP_WAITING"})))(n),t(!1),void window.location.reload()),children:"Install"}),Object(u.jsx)("span",{style:{marginLeft:20,textDecoration:"underline",cursor:"pointer"},onClick:()=>{console.log("ignore"),t(!1)},children:"Ignore"})]}):null};var k=function(){return Object(u.jsxs)(d.a,{className:"App",style:{height:"100vh",width:"100vw"},column:!0,children:[Object(u.jsx)(f,{}),Object(u.jsx)(j,{})]})};n(41);i.a.render(Object(u.jsx)(a.a.StrictMode,{children:Object(u.jsx)(k,{})}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.5231823d.chunk.js.map