(this.webpackJsonpfontanelle=this.webpackJsonpfontanelle||[]).push([[0],{152:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var o=n(1),i=n.n(o),a=n(19),c=n.n(a),r=n(27),s=n.n(r),l=n(7),d=n.n(l),h=n(2),p=e=>Math.round(100*e)/100,u=n(5),g=n.n(u),b=n(50),m=n.n(b),j=(n(150),async e=>{const t=p(e.lat),n=p(e.lng),o='\n    [out:json];\n    (node["amenity"="'.concat(e.amenity,'"](around:').concat(e.around,",").concat(t,",").concat(n,"););\n    out;>;out;\n  "),i=await fetch("https://overpass-api.de/api/interpreter?data=".concat(o,"&output")),a=await i.json(),c=await u.getItem(e.amenity)||[],r=m()(c.concat(a.elements),(e=>e.id));return u.setItem(e.amenity,r),r}),v=n(0),w=function(e){return Object(v.jsx)("svg",{id:"Layer_1",enableBackground:"new 0 0 512 512",height:"20px",viewBox:"0 0 512 512",width:"20px",fill:e.color||"blue",children:Object(v.jsxs)("g",{children:[Object(v.jsx)("path",{d:"m421.082 355.479c-16.269-24.198-32.288-43.872-32.962-44.698-2.849-3.49-7.115-5.514-11.62-5.514s-8.771 2.024-11.62 5.514c-.674.826-16.693 20.5-32.962 44.698-34.685 51.594-34.685 70.908-34.685 77.255 0 43.708 35.559 79.267 79.267 79.267s79.267-35.559 79.267-79.267c0-6.347 0-25.662-34.685-77.255z"}),Object(v.jsx)("path",{d:"m71.233 64.267h224.934c8.284 0 15-6.716 15-15v-34.267c0-8.284-6.716-15-15-15h-224.934c-8.284 0-15 6.716-15 15v34.267c0 8.284 6.716 15 15 15z"}),Object(v.jsx)("path",{d:"m56.233 159.6v64.267c0 8.284 6.716 15 15 15h19.267v-94.267h-19.267c-8.284 0-15 6.716-15 15z"}),Object(v.jsx)("path",{d:"m329.366 256c0 8.284 6.716 15 15 15h64.268c8.284 0 15-6.716 15-15v-32.133c0-43.708-35.56-79.267-79.268-79.267h-67.466v94.267h52.466z"}),Object(v.jsx)("path",{d:"m231.9 128.533h-1.067v-34.266h-94.267v34.267h-1.066c-8.284 0-15 6.716-15 15v96.4c0 8.284 6.716 15 15 15h96.4c8.284 0 15-6.716 15-15v-96.4c0-8.285-6.715-15.001-15-15.001z"})]})})},k=e=>Object(v.jsx)("svg",{version:"1.1",id:"Capa_1",x:"0px",y:"0px",width:"20px",height:"20px",viewBox:"0 0 395 395",xmlSpace:"preserve",fill:e.color||"black",children:Object(v.jsxs)("g",{children:[Object(v.jsx)("path",{d:"M229.412,130.862c-2.405-3.355-6.284-5.346-10.412-5.346h-1.266c-5.524,0-10.424,3.539-12.161,8.782l-27.534,83.09   l-27.662-83.107c-1.743-5.233-6.639-8.765-12.156-8.765h-0.822c-0.051,0-0.104,0.003-0.153,0.003c-0.053,0-0.105-0.003-0.155-0.003   h-0.998c-5.524,0-10.425,3.539-12.163,8.782l-27.533,83.09l-27.661-83.107c-1.742-5.233-6.64-8.765-12.156-8.765h-1.268   c-4.13,0-8.007,1.991-10.414,5.346c-2.407,3.357-3.045,7.669-1.72,11.579l40.125,118.344c1.763,5.201,6.643,8.698,12.135,8.698   h0.53c0.153,0,0.303-0.008,0.455-0.014c0.151,0.006,0.302,0.014,0.454,0.014h0.354c5.5,0,10.386-3.511,12.142-8.721l27.845-82.675   l27.718,82.657c1.751,5.221,6.642,8.739,12.148,8.739h0.527c0.153,0,0.303-0.008,0.456-0.014c0.15,0.006,0.302,0.014,0.454,0.014   h0.355c5.491,0,10.37-3.497,12.134-8.698l40.125-118.344C232.459,138.531,231.818,134.22,229.412,130.862z"}),Object(v.jsx)("path",{d:"M347.88,232.295c-4.756-4.416-12.063-4.578-17.01-0.378c-8.521,7.234-19.511,11.218-30.943,11.218   c-26.069,0-47.277-20.51-47.277-45.721c0-25.116,21.208-45.548,47.277-45.548c11.542,0,22.522,3.916,30.921,11.027   c5.087,4.306,12.625,3.995,17.339-0.719l0.427-0.427c2.544-2.542,3.899-6.036,3.74-9.628c-0.161-3.592-1.822-6.952-4.58-9.258   c-13.371-11.184-30.366-17.344-47.848-17.344c-40.598,0-73.628,32.253-73.628,71.898c0,39.739,33.03,72.07,73.628,72.07   c17.454,0,34.493-6.207,47.979-17.48c2.822-2.36,4.495-5.817,4.589-9.494c0.098-3.678-1.393-7.22-4.087-9.723L347.88,232.295z"}),Object(v.jsx)("path",{d:"M313.001,0H81.999C36.785,0,0,36.784,0,81.998v230.993C0,358.211,36.785,395,81.999,395h231.002   C358.216,395,395,358.211,395,312.991V81.998C395,36.784,358.216,0,313.001,0z M380,312.991C380,349.94,349.945,380,313.001,380   H81.999C45.056,380,15,349.94,15,312.991V81.998C15,45.055,45.056,15,81.999,15h231.002C349.945,15,380,45.055,380,81.998V312.991z   "})]})}),f=n(51);n(152);const x=window.mapboxgl;class O extends o.PureComponent{constructor(...e){super(...e),this.map=h.none,this.drinkingWaterNodes={},this.drinkingWaterMarkers=[],this.publicToiletsNodes={},this.publicToiletsMarkers=[],this.updateDrinkingWater=()=>{Object(h.map)((e=>{var t;g.a.getItem("drinking_water").then((e=>{e&&this.addWaterMarkers(e)})),(t={around:1e3,lat:e.getCenter().lat,lng:e.getCenter().lng},j({amenity:"drinking_water",...t})).then(this.addWaterMarkers)}))(this.map)},this.updateDrinkingWaterDebounce=s()((()=>{this.updateDrinkingWater()}),1e3),this.updatePublicToilets=()=>{Object(h.map)((e=>{var t;g.a.getItem("toilets").then((e=>{e&&this.addPublicToiletsMarkers(e)})),(t={around:1e3,lat:e.getCenter().lat,lng:e.getCenter().lng},j({amenity:"toilets",...t})).then(this.addPublicToiletsMarkers)}))(this.map)},this.updatePublicToiletsDebounce=s()((()=>{this.updatePublicToilets()}),1e3),this.addMarkers=(e,t,n,o)=>{Object(h.map)((i=>{const c=i.getCenter().lat,r=i.getCenter().lng;e.filter((e=>Object(f.a)([c,r],[e.lat,e.lon],{units:"kilometers"})<2)).forEach((e=>{if(!t[e.id]){const c=document.createElement("div");a.render(n,c);const r=new x.Marker({element:c}).setLngLat([e.lon,e.lat]);r.addTo(i),t[e.id]=e,o.push(r)}}))}))(this.map)},this.addWaterMarkers=e=>{this.addMarkers(e,this.drinkingWaterNodes,Object(v.jsx)(w,{}),this.drinkingWaterMarkers)},this.addPublicToiletsMarkers=e=>{this.addMarkers(e,this.publicToiletsNodes,Object(v.jsx)(k,{}),this.publicToiletsMarkers)}}initializeMap(){x.accessToken="pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw",navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const t=new x.Map({container:"map",style:"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true",center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:15,scrollZoom:!1});t.addControl(new x.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),t.addControl(new x.ScaleControl),t.on("load",(()=>{var e;this.map=Object(h.some)(t),this.updateDrinkingWater(),this.updatePublicToilets(),null===(e=document.querySelector(".mapboxgl-ctrl-geolocate"))||void 0===e||e.click()})),t.on("move",(()=>{this.updateDrinkingWaterDebounce(),this.updatePublicToiletsDebounce()}))}))}componentDidMount(){this.initializeMap()}componentDidUpdate(){requestAnimationFrame((()=>{Object(h.map)((e=>e.resize()))(this.map)}))}render(){return Object(v.jsx)(d.a,{grow:!0,id:"map"})}}var y=O;const C=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function M(e){if("serviceWorker"in navigator){if(new URL("/fontanelle",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const t="".concat("/fontanelle","/service-worker.js");C?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((n=>{const o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):W(e,t)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):W(t,e)}))}}function W(e,t){navigator.serviceWorker.register(e,{scope:"/fontanelle/"}).then((e=>{console.log(e.scope),e.onupdatefound=()=>{const n=e.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((e=>{console.error("Error during service worker registration:",e)}))}var T=()=>{const[e,t]=i.a.useState(!1),[n,a]=i.a.useState(h.none),c=e=>{t(!0),a(Object(h.fromNullable)(e.waiting))};Object(o.useEffect)((()=>{M({onUpdate:c})}),[]);return e?Object(v.jsxs)(d.a,{className:"updateAvailable",vAlignContent:"center",hAlignContent:"center",style:{background:"lightgreen",height:25,color:"black"},children:["Update Available",Object(v.jsx)("span",{style:{marginLeft:60,textDecoration:"underline",cursor:"pointer"},onClick:()=>(console.log("reload page"),Object(h.map)((e=>e.postMessage({type:"SKIP_WAITING"})))(n),t(!1),void window.location.reload()),children:"Install"}),Object(v.jsx)("span",{style:{marginLeft:20,textDecoration:"underline",cursor:"pointer"},onClick:()=>{console.log("ignore"),t(!1)},children:"Ignore"})]}):null};var D=function(){return Object(v.jsxs)(d.a,{className:"App",style:{height:"100vh",width:"100vw"},column:!0,children:[Object(v.jsx)(T,{}),Object(v.jsx)(y,{})]})};n(157);c.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(D,{})}),document.getElementById("root"))}},[[158,1,2]]]);
//# sourceMappingURL=main.5e4b1279.chunk.js.map