(this.webpackJsonpfontanelle=this.webpackJsonpfontanelle||[]).push([[0],{191:function(e,t,n){},196:function(e,t,n){},197:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),c=n(22),a=n.n(c),i=n(65),l=n(66),s=n(71),u=n(69),d=n(32),p=n.n(d),f=n(8),g=n.n(f),h=n(2),b=n(23),m=n(33),j=n.n(m),v=n(67),k=function(e){return Math.round(100*e)/100},w=n(5),x=n.n(w),y=n(68),O=n.n(y),C=(n(171),function(){var e=Object(v.a)(j.a.mark((function e(t){var n,o,r,c,a,i,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k(t.lat),o=k(t.lng),r='\n    [out:json];\n    (node["amenity"="'.concat(t.amenity,'"](around:').concat(t.around,",").concat(n,",").concat(o,"););\n    out;>;out;\n  "),"https://overpass.kumi.systems/api/interpreter",e.next=6,fetch("".concat("https://overpass.kumi.systems/api/interpreter","?data=").concat(r,"&output"));case 6:return c=e.sent,e.next=9,c.json();case 9:return a=e.sent,e.next=12,w.getItem(t.amenity);case 12:if(e.t0=e.sent,e.t0){e.next=15;break}e.t0=[];case 15:return i=e.t0,l=O()(i.concat(a.elements),(function(e){return e.id})),w.setItem(t.amenity,l),e.abrupt("return",l);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),M=function(e){return C(Object(b.a)({amenity:"drinking_water"},e))},W=n(0),T=function(){return Object(W.jsxs)("svg",{width:"20px",height:"20px",viewBox:"0 0 508 508",enableBackground:"new 0 0 508 508",xmlSpace:"preserve",children:[Object(W.jsx)("circle",{fill:"#324A5E",cx:"254",cy:"254",r:"254"}),Object(W.jsx)("path",{fill:"#54C0EB",d:"M252,414h4c62.8,0,115.2-50.4,114-113.2c0-8-1.2-15.6-2.8-22.8C360,246.4,324,210,298,170.8  c-27.2-37.6-44-77.6-44-76.4c-0.4-0.8-17.2,39.2-44,76.4c-25.6,39.2-62,76-69.2,106.8c-2,7.2-2.8,14.8-2.8,22.8  C136.8,363.2,189.2,414,252,414z"}),Object(W.jsxs)("g",{children:[Object(W.jsx)("path",{fill:"#84DBFF",d:"M177.2,353.6c6-0.4,9.6-6,7.2-10.8c-3.2-7.2-6-14.8-7.2-22.8c-1.6-8-2-15.6-1.6-23.2   c1.2-32,32-75.2,51.6-118.4c2-3.6,3.6-7.6,5.2-11.2c-0.8,1.2-1.6,2.4-2.4,3.2c-26.4,40.4-64,78.8-70.8,110   c-1.6,7.2-2.4,15.2-2.4,23.2c0.4,16.8,4.8,32,12.4,46C171.2,352.4,174,354,177.2,353.6L177.2,353.6z"}),Object(W.jsx)("ellipse",{transform:"matrix(-0.042 -0.9991 0.9991 -0.042 -169.3631 569.6013)",fill:"#84DBFF",cx:"188.401",cy:"365.998",rx:"8.4",ry:"9.2"})]})]})},D=function(e){return C(Object(b.a)({amenity:"toilets"},e))},A=function(e){return Object(W.jsx)("svg",{width:"20px",height:"20px",viewBox:"0 0 395 395",xmlSpace:"preserve",fill:"black",style:{background:e.color||"white",borderRadius:3},children:Object(W.jsxs)("g",{children:[Object(W.jsx)("path",{d:"M229.412,130.862c-2.405-3.355-6.284-5.346-10.412-5.346h-1.266c-5.524,0-10.424,3.539-12.161,8.782l-27.534,83.09   l-27.662-83.107c-1.743-5.233-6.639-8.765-12.156-8.765h-0.822c-0.051,0-0.104,0.003-0.153,0.003c-0.053,0-0.105-0.003-0.155-0.003   h-0.998c-5.524,0-10.425,3.539-12.163,8.782l-27.533,83.09l-27.661-83.107c-1.742-5.233-6.64-8.765-12.156-8.765h-1.268   c-4.13,0-8.007,1.991-10.414,5.346c-2.407,3.357-3.045,7.669-1.72,11.579l40.125,118.344c1.763,5.201,6.643,8.698,12.135,8.698   h0.53c0.153,0,0.303-0.008,0.455-0.014c0.151,0.006,0.302,0.014,0.454,0.014h0.354c5.5,0,10.386-3.511,12.142-8.721l27.845-82.675   l27.718,82.657c1.751,5.221,6.642,8.739,12.148,8.739h0.527c0.153,0,0.303-0.008,0.456-0.014c0.15,0.006,0.302,0.014,0.454,0.014   h0.355c5.491,0,10.37-3.497,12.134-8.698l40.125-118.344C232.459,138.531,231.818,134.22,229.412,130.862z"}),Object(W.jsx)("path",{d:"M347.88,232.295c-4.756-4.416-12.063-4.578-17.01-0.378c-8.521,7.234-19.511,11.218-30.943,11.218   c-26.069,0-47.277-20.51-47.277-45.721c0-25.116,21.208-45.548,47.277-45.548c11.542,0,22.522,3.916,30.921,11.027   c5.087,4.306,12.625,3.995,17.339-0.719l0.427-0.427c2.544-2.542,3.899-6.036,3.74-9.628c-0.161-3.592-1.822-6.952-4.58-9.258   c-13.371-11.184-30.366-17.344-47.848-17.344c-40.598,0-73.628,32.253-73.628,71.898c0,39.739,33.03,72.07,73.628,72.07   c17.454,0,34.493-6.207,47.979-17.48c2.822-2.36,4.495-5.817,4.589-9.494c0.098-3.678-1.393-7.22-4.087-9.723L347.88,232.295z"}),Object(W.jsx)("path",{d:"M313.001,0H81.999C36.785,0,0,36.784,0,81.998v230.993C0,358.211,36.785,395,81.999,395h231.002   C358.216,395,395,358.211,395,312.991V81.998C395,36.784,358.216,0,313.001,0z M380,312.991C380,349.94,349.945,380,313.001,380   H81.999C45.056,380,15,349.94,15,312.991V81.998C15,45.055,45.056,15,81.999,15h231.002C349.945,15,380,45.055,380,81.998V312.991z   "})]})})},P=n(70),I=n(6),S=n.n(I),N=(n(190),n(191),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).map=h.none,e.drinkingWaterNodes={},e.drinkingWaterMarkers=[],e.publicToiletsNodes={},e.publicToiletsMarkers=[],e.updateDrinkingWater=function(){Object(h.map)((function(t){x.a.getItem("drinking_water").then((function(t){t&&e.addWaterMarkers(t)})),M({around:1e3,lat:t.getCenter().lat,lng:t.getCenter().lng}).then(e.addWaterMarkers)}))(e.map)},e.updateDrinkingWaterDebounce=p()((function(){e.updateDrinkingWater()}),1e3),e.updatePublicToilets=function(){Object(h.map)((function(t){x.a.getItem("toilets").then((function(t){t&&e.addPublicToiletsMarkers(t)})),D({around:1e3,lat:t.getCenter().lat,lng:t.getCenter().lng}).then(e.addPublicToiletsMarkers)}))(e.map)},e.updatePublicToiletsDebounce=p()((function(){e.updatePublicToilets()}),1e3),e.addMarkers=function(t,n,o,r){Object(h.map)((function(e){var a=e.getCenter().lat,i=e.getCenter().lng;t.filter((function(e){return Object(P.a)([a,i],[e.lat,e.lon],{units:"kilometers"})<2})).forEach((function(t){if(!n[t.id]){var a=document.createElement("div");c.render(o(t),a);var i=new S.a.Marker({element:a}).setLngLat([t.lon,t.lat]),l=new S.a.Popup({offset:25}).setHTML('<div style="overflow-wrap: break-word;">\n                '.concat(Object.keys(t.tags).map((function(e){return"<b>".concat(e,":</b> ").concat(t.tags[e])})).join("<br />"),"\n\n                ").concat(t.tags.mapillary?'<button style="margin-top: 16px;">\n                        <a href="'.concat(t.tags.mapillary,'" target="_blank" rel="noopener noreferrer">\n                          See street view\n                        </a>\n                      </button>'):"","\n              </div>\n              "));i.setPopup(l),i.addTo(e),n[t.id]=t,r.push(i)}}))}))(e.map)},e.addWaterMarkers=function(t){e.addMarkers(t,e.drinkingWaterNodes,(function(){return Object(W.jsx)(T,{})}),e.drinkingWaterMarkers)},e.addPublicToiletsMarkers=function(t){e.addMarkers(t,e.publicToiletsNodes,(function(e){return Object(W.jsx)(A,{color:"string"===typeof e.tags.fee&&"no"!==e.tags.fee?"gold":"white"})}),e.publicToiletsMarkers)},e}return Object(l.a)(n,[{key:"initializeMap",value:function(){var e=this;S.a.accessToken="pk.eyJ1IjoiZnJhbmNlc2NvY2lvcmlhIiwiYSI6ImNqcThyejR6ODA2ZDk0M25rZzZjcGo4ZmcifQ.yRWHQbG1dJjDp43d01bBOw",navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var n=new S.a.Map({container:"map",style:"mapbox://styles/francescocioria/cjqi3u6lmame92rmw6aw3uyhm?optimize=true",center:{lat:t.coords.latitude,lng:t.coords.longitude},zoom:15,scrollZoom:!1});n.addControl(new S.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),n.addControl(new S.a.ScaleControl),n.on("load",(function(){var t;e.map=Object(h.some)(n),e.updateDrinkingWater(),e.updatePublicToilets(),null===(t=document.querySelector(".mapboxgl-ctrl-geolocate"))||void 0===t||t.click()})),n.on("move",(function(){e.updateDrinkingWaterDebounce(),e.updatePublicToiletsDebounce()}))}))}},{key:"componentDidMount",value:function(){this.initializeMap()}},{key:"componentDidUpdate",value:function(){var e=this;requestAnimationFrame((function(){Object(h.map)((function(e){return e.resize()}))(e.map)}))}},{key:"render",value:function(){return Object(W.jsx)(g.a,{grow:!0,id:"map"})}}]),n}(o.PureComponent)),z=n(34),L=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function B(e){if("serviceWorker"in navigator){if(new URL("/fontanelle",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/fontanelle","/service-worker.js");L?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):E(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):E(t,e)}))}}function E(e,t){navigator.serviceWorker.register(e,{scope:"/fontanelle/"}).then((function(e){console.log(e.scope),e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var U=function(){var e=r.a.useState(!1),t=Object(z.a)(e,2),n=t[0],c=t[1],a=r.a.useState(h.none),i=Object(z.a)(a,2),l=i[0],s=i[1],u=function(e){c(!0),s(Object(h.fromNullable)(e.waiting))};Object(o.useEffect)((function(){B({onUpdate:u})}),[]);return n?Object(W.jsxs)(g.a,{className:"updateAvailable",vAlignContent:"center",hAlignContent:"center",style:{background:"lightgreen",height:25,color:"black"},children:["Update Available",Object(W.jsx)("span",{style:{marginLeft:60,textDecoration:"underline",cursor:"pointer"},onClick:function(){return console.log("reload page"),Object(h.map)((function(e){return e.postMessage({type:"SKIP_WAITING"})}))(l),c(!1),void window.location.reload()},children:"Install"}),Object(W.jsx)("span",{style:{marginLeft:20,textDecoration:"underline",cursor:"pointer"},onClick:function(){console.log("ignore"),c(!1)},children:"Ignore"})]}):null};var R=function(){return Object(W.jsxs)(g.a,{className:"App",style:{height:"100vh",width:"100vw"},column:!0,children:[Object(W.jsx)(U,{}),Object(W.jsx)(N,{})]})};n(196);a.a.render(Object(W.jsx)(r.a.StrictMode,{children:Object(W.jsx)(R,{})}),document.getElementById("root"))}},[[197,1,2]]]);
//# sourceMappingURL=main.28dd021c.chunk.js.map